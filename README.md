# -1

1、通讯

全双工、半双工及单工通讯

根据通讯的数据同步方式，分为同步和异步两种，可以根据通讯过程中是否有使用到时钟信号进行简单的区分。

在同步通讯中，收发设备双方会使用一根信号线表示时钟信号，在时钟信号的驱动下双方进行协
调，同步数据.
通讯中通常双方会统一规定在时钟信号的上升沿或下降沿对数据线进行采样。

在异步通讯中不使用时钟信号进行数据同步，它们直接在数据信号中穿插一些同步用的信号位，
或者把主体数据进行打包，以数据帧的格式传输数据

![image](https://github.com/user-attachments/assets/62eefaba-5c8a-45c1-8090-95b23d14b873)


通讯速率
衡量通讯性能的一个非常重要的参数就是通讯速率，通常以比特率 (Bitrate) 来表示，即每秒钟传
输的二进制位数，单位为比特每秒 (bit/s)

容易与比特率混淆的概念是“波特率”(Baudrate)，它表示每秒钟传输了多少个码元。而码元是通讯信号调制的概念，通讯中常用时间间隔相同的符号
来表示一个二进制数字，这样的信号称为码元

如常见的通讯传输中，用 0V 表示数字 0，5V 表
示数字 1，那么一个码元可以表示两种状态 0 和 1，所以一个码元等于一个二进制比特位，此时
波特率的大小与比特率一致；如果在通讯传输中，有 0V、2V、4V 以及 6V 分别表示二进制数 00、
01、10、11，那么每个码元可以表示四种状态，即两个二进制比特位，所以码元数是二进制比特
位数的一半，这个时候的波特率为比特率的一半

因为很多常见的通讯中一个码元都是表示两种状态，人们常常直接以波特率来表示比特率，虽然严格来说没什么错误，但希望您能了解它们的
区别。

2、

在计算机科学里，大部分复杂的问题都可以通过分层来简化。如芯片被分为内核层和片上外设；STM32HAL 库是在寄存器与用户代码之间的软件层，

对于通讯协议，我们也以分层的方式来理解，最基本的是把它分为物理层和协议层。物理层规定通讯系统中具有机械、电子功能部分的
特性，确保原始数据在物理媒体的传输。协议层主要规定通讯逻辑，统一收发双方的数据打包、解包标准。简单来说物理层规定我们用嘴巴还是用肢体来交流，协议层则规定我们用中文还是英文来交流。

物理层

串口通讯的物理层有很多标准及变种，我们主要讲解 RS-232 标准，RS-232 标准主要规定了信号
的用途、通讯接口以及信号的电平标准。

![image](https://github.com/user-attachments/assets/831cc7eb-ace0-45c2-94cc-bca65f20a65a)

在上面的通讯方式中，两个通讯设备的“DB9 接口”之间通过串口信号线建立起连接，串口信号
线中使用“RS-232 标准”传输数据信号。由于 RS-232 电平标准的信号不能直接被控制器直接识
别，所以这些信号会经过一个“电平转换芯片”转换成控制器能识别的“TTL 标准”的电平信号，
才能实现通讯。

电平标准

根据通讯使用的电平标准不同，串口通讯可分为 TTL 标准及 RS-232 标准

![image](https://github.com/user-attachments/assets/a5771caa-49e4-4dd6-a43c-a881933c3482)

我们知道常见的电子电路中常使用 TTL 的电平标准，理想状态下，使用 5V 表示二进制逻辑 1，
使用 0V 表示逻辑 0；而为了增加串口通讯的远距离传输及抗干扰能力，它使用-15V 表示逻辑 1，
+15V 表示逻辑 0


RS-232 信号线

  在最初的应用中，RS-232 串口标准常用于计算机、路由与调制调解器 (MODEN，俗称“猫”) 之
  间的通讯，在这种通讯系统中，设备被分为数据终端设备 DTE(计算机、路由) 和数据通讯设备
  DCE(调制调解器)。

在目前的其它工业控制使用的串口通讯中，一般只使用 RXD、TXD 以及 GND 三条信号线，直
接传输数据信号

协议层

串口通讯的数据包由发送设备通过自身的 TXD 接口传输到接收设备的 RXD 接口。在串口通讯
的协议层中，规定了数据包的内容，它由启始位、主体数据、校验位以及停止位组成，通讯双方
的数据包格式要约定一致才能正常收发数据

![image](https://github.com/user-attachments/assets/a773655e-f134-403f-85a5-c7489ed47245)

波特率

串口异步通讯，异步通讯中由于没有时钟信号 (如前面讲解的 DB9 接口中是没有时钟信号的)，所以两个通讯设备之间需要约定好波特率，即每个码元的长度，以便对信
号进行解码

  通讯的起始和停止信号
      串口通讯的一个数据包从起始信号开始，直到停止信号结束。数据包的起始信号由一个逻辑 0 的
      数据位表示，而数据包的停止信号可由 0.5、1、1.5 或 2 个逻辑 1 的数据位表示，只要双方约定
      一致即可。
	  
  有效数据
      在数据包的起始位之后紧接着的就是要传输的主体数据内容，也称为有效数据，有效数据的长度
      常被约定为 5、6、7 或 8 位长
	  
  数据校验
  	  在有效数据之后，有一个可选的数据校验位。由于数据通信相对更容易受到外部干扰导致传输
	  数据出现偏差，可以在传输过程加上校验位来解决这个问题。校验方法有奇校验 (odd)、偶校验
	 (even)、0 校验 (space)、1 校验 (mark) 以及无校验 (noparity)
  
  	奇校验要求有效数据和校验位中“1”的个数为奇数，比如一个 8 位长的有效数据为：01101001，
  	此时总共有 4 个“1”，为达到奇校验效果，校验位为“1”，最后传输的数据将是 8 位的有效数据
  	加上 1 位的校验位总共 9 位。

 	偶校验与奇校验要求刚好相反，要求帧数据和校验位中“1”的个数为偶数，比如数据帧：11001010，
 	此时数据帧“1”的个数为 4 个，所以偶校验位为“0”。
 
	 0 校验是不管有效数据中的内容是什么，校验位总为“0”，1 校验是校验位总为“1”。

USART 简介

有别于 USART 还有一个 UART(UniversalAsynchronous Receiver and Transmitter)，它是在 USART 基础上裁剪掉了同步通信功能，只有异步
通信。简单区分同步和异步就是看通信时需不需要对外提供时钟输出，我们平时用的串口通信基
本都是 UART。

串行通信一般是以帧格式传输数据，即是一帧一帧的传输，每帧包含有起始信号、数据信息、停
止信息，可能还有校验信息。USART 就是对这些传输参数有具体规定，当然也不是只有唯一一
个参数值，很多参数值都可以自定义设置，只是增强它的兼容性

USART 在 STM32 应用最多莫过于“打印”程序信息，一般在硬件设计时都会预留一个 USART
通信接口连接电脑，用于在调试程序是可以把一些调试信息“打印”在电脑端的串口调试助手工
具上，从而了解程序运行是否正确、如果出错哪具体哪里出错等等。

USART 的功能框图包含了 USART 最核心内容，掌握了功能框图，对 USART 就有一个整体的把
握，在编程时就思路就非常清晰

![image](https://github.com/user-attachments/assets/6da7ecbb-3f1e-44be-8b5e-0f7188ae0ef7)

TX：发送数据输出引脚。
RX：接收数据输入引脚。
SW_RX：数据接收引脚，只用于单线和智能卡模式，属于内部引脚，没有具体外部引脚。
nRTS：请求以发送 (Request To Send)，n 表示低电平有效。如果使能 RTS 流控制，当 USART 接
收器准备好接收新数据时就会将 nRTS 变成低电平；当接收寄存器已满时，nRTS 将被设置为高
电平。该引脚只适用于硬件流控制。
nCTS：清除以发送 (Clear To Send)，n 表示低电平有效。如果使能 CTS 流控制，发送器在发送下
一帧数据之前会检测 nCTS 引脚，如果为低电平，表示可以发送数据，如果为高电平则在发送完
当前数据帧之后停止发送。该引脚只适用于硬件流控制。
SCLK：发送器时钟输出引脚。这个引脚仅适用于同步模式

![image](https://github.com/user-attachments/assets/bde3cf84-e614-420e-95c4-73a1d40a369a)


STM32F103VET6 系统控制器有三个 USART 和两个 UART，其中 USART1 和时钟来源于 APB2 总
线时钟，其最大频率为 72MHz，其他四个的时钟来源于 APB1 总线时钟，其最大频率为 36MHz。
UART 只是异步传输功能，所以没有 SCLK、nCTS 和 nRTS 功能引脚。































